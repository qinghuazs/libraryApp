# 书籍分类管理需求文档

## 1. 概述

### 1.1 功能定位

书籍分类管理不是面向 C 端用户的，而是面向管理员的，管理员可以在系统中添加、删除、修改分类档案。

图书分类有国家标准和国际标准，中国国家标准为《中国图书馆分类法》（简称中图法），国际标准为《杜威十进制分类法》等。这里我们不采用这两种专业分类方法，而是采用**用户友好的通俗分类方法**，预置一些分类信息，便于普通用户理解和使用。

### 1.2 设计原则

- **简单易用**：分类层级控制在2级，避免过于复杂
- **通俗易懂**：使用日常用语，而非专业术语
- **灵活扩展**：管理员可根据实际需求调整分类
- **可视化呈现**：使用图标、颜色增强视觉识别

---

## 2. 标准分类体系

### 2.1 分类树形结构

本系统采用**二级分类体系**，共设置 9 个一级分类：

```
小说
├─ 科幻
├─ 推理
├─ 武侠
├─ 言情
├─ 历史
└─ 其他

文学
├─ 诗歌
├─ 散文
├─ 传记
└─ 其他

社科
├─ 哲学
├─ 心理学
├─ 社会学
├─ 政治
└─ 经济

历史
├─ 中国史
├─ 世界史
├─ 考古
└─ 文化

科技
├─ 计算机
├─ 科普
├─ 数学
└─ 其他

艺术
├─ 绘画
├─ 音乐
├─ 摄影
└─ 设计

生活
├─ 健康
├─ 美食
├─ 旅行
└─ 家居

童书
├─ 绘本
├─ 儿童文学
├─ 科普
└─ 教辅

其他
└─ 未分类
```

### 2.2 分类详细列表

| 编号 | 一级分类 | 二级分类 | 说明 | 图标建议 | 颜色建议 |
|------|---------|---------|------|---------|---------|
| 1.1 | 小说 | 科幻 | 科幻、奇幻类小说 | 🚀 | #4A90E2 |
| 1.2 | 小说 | 推理 | 推理、悬疑、侦探类 | 🔍 | #7B68EE |
| 1.3 | 小说 | 武侠 | 武侠、仙侠类小说 | ⚔️ | #CD5C5C |
| 1.4 | 小说 | 言情 | 言情、爱情类小说 | 💕 | #FF69B4 |
| 1.5 | 小说 | 历史 | 历史小说 | 📜 | #DAA520 |
| 1.6 | 小说 | 其他 | 其他类型小说 | 📖 | #808080 |
| 2.1 | 文学 | 诗歌 | 诗歌、诗词集 | ✍️ | #9370DB |
| 2.2 | 文学 | 散文 | 散文、随笔 | 🍂 | #BC8F8F |
| 2.3 | 文学 | 传记 | 人物传记、自传 | 👤 | #696969 |
| 2.4 | 文学 | 其他 | 其他文学作品 | 📚 | #808080 |
| 3.1 | 社科 | 哲学 | 哲学、思想类 | 🤔 | #8B4513 |
| 3.2 | 社科 | 心理学 | 心理学 | 🧠 | #20B2AA |
| 3.3 | 社科 | 社会学 | 社会学、人类学 | 👥 | #4682B4 |
| 3.4 | 社科 | 政治 | 政治、法律 | ⚖️ | #B22222 |
| 3.5 | 社科 | 经济 | 经济学、管理学 | 💰 | #FFD700 |
| 4.1 | 历史 | 中国史 | 中国历史 | 🏯 | #DC143C |
| 4.2 | 历史 | 世界史 | 世界历史 | 🌍 | #228B22 |
| 4.3 | 历史 | 考古 | 考古、文物 | 🏺 | #CD853F |
| 4.4 | 历史 | 文化 | 文化史、思想史 | 🎭 | #DDA0DD |
| 5.1 | 科技 | 计算机 | 编程、互联网、AI | 💻 | #1E90FF |
| 5.2 | 科技 | 科普 | 科普读物 | 🔬 | #32CD32 |
| 5.3 | 科技 | 数学 | 数学、物理、化学 | 🧮 | #FF8C00 |
| 5.4 | 科技 | 其他 | 其他科技类 | 🛠️ | #808080 |
| 6.1 | 艺术 | 绘画 | 绘画、美术 | 🎨 | #FF1493 |
| 6.2 | 艺术 | 音乐 | 音乐理论、乐谱 | 🎵 | #9932CC |
| 6.3 | 艺术 | 摄影 | 摄影、影像 | 📷 | #708090 |
| 6.4 | 艺术 | 设计 | 设计、建筑 | 🏛️ | #2F4F4F |
| 7.1 | 生活 | 健康 | 健康、养生、运动 | 💪 | #00CED1 |
| 7.2 | 生活 | 美食 | 烹饪、美食 | 🍳 | #FF6347 |
| 7.3 | 生活 | 旅行 | 旅行、地理 | ✈️ | #87CEEB |
| 7.4 | 生活 | 家居 | 家居、园艺 | 🏡 | #3CB371 |
| 8.1 | 童书 | 绘本 | 儿童绘本 | 🌈 | #FFA500 |
| 8.2 | 童书 | 儿童文学 | 儿童文学作品 | 🧸 | #FFB6C1 |
| 8.3 | 童书 | 科普 | 儿童科普 | 🦕 | #90EE90 |
| 8.4 | 童书 | 教辅 | 教辅、练习册 | ✏️ | #F0E68C |
| 9.1 | 其他 | 未分类 | 暂未分类的书籍 | 📦 | #D3D3D3 |

### 2.3 一级分类汇总

| 一级分类 | 分类代码 | 二级分类数量 | 图标 | 颜色 | 说明 |
|---------|---------|------------|------|------|------|
| 小说 | NOVEL | 6 | 📖 | #FF6B6B | 各类小说作品 |
| 文学 | LITERATURE | 4 | 📚 | #9370DB | 文学类作品 |
| 社科 | SOCIAL | 5 | 👥 | #4682B4 | 社会科学类 |
| 历史 | HISTORY | 4 | 🏯 | #DC143C | 历史相关书籍 |
| 科技 | TECH | 4 | 💻 | #1E90FF | 科学技术类 |
| 艺术 | ART | 4 | 🎨 | #FF1493 | 艺术相关书籍 |
| 生活 | LIFE | 4 | 💪 | #00CED1 | 生活实用类 |
| 童书 | CHILDREN | 4 | 🌈 | #FFA500 | 儿童读物 |
| 其他 | OTHER | 1 | 📦 | #D3D3D3 | 未分类书籍 |

---

## 3. 管理员功能

### 3.1 分类管理 CRUD

#### 3.1.1 添加分类

**功能说明**：管理员可以添加新的分类

**UI设计**：

```
┌─────────────────────────────────────┐
│  添加分类                            │
├─────────────────────────────────────┤
│                                     │
│  分类层级：                          │
│  ○ 一级分类  ● 二级分类              │
│                                     │
│  父级分类（二级分类必填）：           │
│  ┌───────────────────────────────┐  │
│  │ 小说                      ▾   │  │
│  └───────────────────────────────┘  │
│                                     │
│  分类名称：*                         │
│  ┌───────────────────────────────┐  │
│  │ 悬疑                          │  │
│  └───────────────────────────────┘  │
│                                     │
│  分类代码（英文）：                  │
│  ┌───────────────────────────────┐  │
│  │ SUSPENSE                      │  │
│  └───────────────────────────────┘  │
│                                     │
│  图标 Emoji：                        │
│  ┌───────────────────────────────┐  │
│  │ 🕵️                            │  │
│  └───────────────────────────────┘  │
│                                     │
│  颜色：                              │
│  ┌───────┐                          │
│  │ 🎨 #8B008B                     │  │
│  └───────┘                          │
│                                     │
│  说明：                              │
│  ┌───────────────────────────────┐  │
│  │ 悬疑、推理类小说              │  │
│  │                               │  │
│  └───────────────────────────────┘  │
│                                     │
│  排序：                              │
│  ┌─────┐                            │
│  │  2  │                            │
│  └─────┘                            │
│                                     │
│  [ 取消 ]         [ 保存 ]          │
│                                     │
└─────────────────────────────────────┘
```

校验：

- 分类名称：必填，长度限制为 2-20 个字符
- 分类代码：必填，长度限制为 2-10 个字符，只能包含字母、数字和下划线
- 图标 Emoji：可选，长度限制为 1 个字符
- 颜色：可选，格式为 #RRGGBB 或 #RGB
- 说明：可选，长度限制为 200 个字符
- 排序：可选，整数，默认值为 当前最大排序值 + 1

分类名称校验：
- 一级分类：必填，长度限制为 2-20 个字符
- 二级分类：必填，长度限制为 2-20 个字符
- 一级分类下的二级分类数量不能超过 20 个
- 同一个一级分类下的二级分类名称不能重复
- 一级分类的名称不可重复

分类编码校验：
- 一级分类：必填，长度限制为 2-10 个字符，只能包含字母、数字和下划线
- 二级分类：必填，长度限制为 2-10 个字符，只能包含字母、数字和下划线
- 同一个一级分类下的二级分类编码不能重复
- 一级分类的编码不能重复


#### 3.1.2 修改分类

**功能说明**：管理员可以编辑现有分类的信息

**注意事项**：
- 修改分类后，已使用该分类的书籍自动更新
- 不允许修改系统预设的核心分类代码

#### 3.1.3 删除分类

**功能说明**：管理员可以删除不再使用的分类

**删除流程**：

```
选择要删除的分类
    ↓
检查是否有书籍使用该分类
    ↓
[有书籍] → 提示迁移 → 选择新分类 → 批量迁移 → 删除
    ↓
[无书籍] → 直接删除
```

**UI设计（有书籍时）**：

```
┌─────────────────────────────────────┐
│  ⚠️  删除分类                        │
├─────────────────────────────────────┤
│                                     │
│  当前分类："小说 - 悬疑"              │
│                                     │
│  该分类下有 23 本书籍，删除前需要     │
│  将这些书籍迁移到其他分类。           │
│                                     │
│  迁移至：                            │
│  ┌───────────────────────────────┐  │
│  │ 小说 - 推理               ▾   │  │
│  └───────────────────────────────┘  │
│                                     │
│  ☑ 我确认要删除该分类                │
│                                     │
│  [ 取消 ]         [ 确认删除 ]       │
│                                     │
└─────────────────────────────────────┘
```

#### 3.1.4 查看分类列表

**UI设计**：

```
┌──────────────────────────────────────────────────────┐
│  📂 分类管理                        [ + 添加分类 ]    │
├──────────────────────────────────────────────────────┤
│                                                      │
│  🔍 搜索分类...                    [ 批量操作 ▾ ]    │
│                                                      │
│  ┌────────────────────────────────────────────────┐ │
│  │ 编号  │ 一级分类 │ 二级分类 │ 图标 │ 书籍数 │ 操作│ │
│  ├────────────────────────────────────────────────┤ │
│  │ 1.1   │ 小说    │ 科幻    │ 🚀  │  45   │ 编辑│ │
│  │ 1.2   │ 小说    │ 推理    │ 🔍  │  32   │ 编辑│ │
│  │ 1.3   │ 小说    │ 武侠    │ ⚔️  │  18   │ 编辑│ │
│  │ 2.1   │ 文学    │ 诗歌    │ ✍️  │  12   │ 编辑│ │
│  │ 2.2   │ 文学    │ 散文    │ 🍂  │  23   │ 编辑│ │
│  │ ...   │ ...     │ ...     │ ... │  ...  │ ... │ │
│  └────────────────────────────────────────────────┘ │
│                                                      │
│  总计：36 个分类                                      │
│                                                      │
└──────────────────────────────────────────────────────┘
```

### 3.2 排序管理

**功能说明**：管理员可以调整分类的显示顺序

**实现方式**：
- 拖拽排序
- 手动输入排序号

**UI设计**：

```
┌─────────────────────────────────────┐
│  分类排序（拖拽调整）                 │
├─────────────────────────────────────┤
│                                     │
│  小说                                │
│  ┌───────────────────────────────┐  │
│  │ ≡ 科幻     🚀  45本           │  │
│  │ ≡ 推理     🔍  32本           │  │
│  │ ≡ 武侠     ⚔️  18本           │  │
│  │ ≡ 言情     💕  29本           │  │
│  │ ≡ 历史     📜  15本           │  │
│  │ ≡ 其他     📖  23本           │  │
│  └───────────────────────────────┘  │
│                                     │
│  [ 取消 ]         [ 保存排序 ]       │
│                                     │
└─────────────────────────────────────┘
```

### 3.3 批量操作

**支持功能**：
- 批量启用/禁用分类
- 批量设置图标
- 批量设置颜色主题
- 批量导出/导入分类配置

---

## 4. 数据库设计

### 4.1 分类表

```sql
CREATE TABLE categories (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '分类ID',
    category_code VARCHAR(20) UNIQUE NOT NULL COMMENT '分类编码：NOVEL, NOVEL_SCIFI',
    category_name VARCHAR(50) NOT NULL COMMENT '分类名称：小说、科幻',
    category_name_en VARCHAR(100) COMMENT '英文名称：Novel, Science Fiction',
    parent_id INT COMMENT '父分类ID，NULL表示一级分类',
    level TINYINT NOT NULL COMMENT '分类层级：1-一级，2-二级',
    icon VARCHAR(50) COMMENT '图标emoji或图标名称',
    color VARCHAR(7) COMMENT '颜色代码 #FF5733',
    description TEXT COMMENT '分类说明',
    sort_order INT DEFAULT 0 COMMENT '排序序号，数字越小越靠前',
    is_active BOOLEAN DEFAULT TRUE COMMENT '是否启用',
    is_system BOOLEAN DEFAULT FALSE COMMENT '是否系统预设（不可删除）',
    book_count INT DEFAULT 0 COMMENT '书籍数量（冗余字段）',
    created_by INT COMMENT '创建人（管理员ID）',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    INDEX idx_parent (parent_id),
    INDEX idx_level (level),
    INDEX idx_code (category_code),
    INDEX idx_sort (sort_order)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='图书分类表';
```

### 4.2 分类操作日志表

```sql
CREATE TABLE category_operation_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    category_id INT NOT NULL COMMENT '分类ID',
    operation_type ENUM('create', 'update', 'delete', 'enable', 'disable') NOT NULL,
    operator_id INT NOT NULL COMMENT '操作人（管理员ID）',
    operator_name VARCHAR(50) COMMENT '操作人姓名',
    before_data JSON COMMENT '修改前的数据',
    after_data JSON COMMENT '修改后的数据',
    operation_desc TEXT COMMENT '操作说明',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    INDEX idx_category (category_id),
    INDEX idx_operator (operator_id),
    INDEX idx_created (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='分类操作日志表';
```

### 4.3 初始化数据脚本

```sql
-- 插入一级分类
INSERT INTO categories (category_code, category_name, level, icon, color, sort_order, is_system) VALUES
('NOVEL', '小说', 1, '📖', '#FF6B6B', 1, TRUE),
('LITERATURE', '文学', 1, '📚', '#9370DB', 2, TRUE),
('SOCIAL', '社科', 1, '👥', '#4682B4', 3, TRUE),
('HISTORY', '历史', 1, '🏯', '#DC143C', 4, TRUE),
('TECH', '科技', 1, '💻', '#1E90FF', 5, TRUE),
('ART', '艺术', 1, '🎨', '#FF1493', 6, TRUE),
('LIFE', '生活', 1, '💪', '#00CED1', 7, TRUE),
('CHILDREN', '童书', 1, '🌈', '#FFA500', 8, TRUE),
('OTHER', '其他', 1, '📦', '#D3D3D3', 9, TRUE);

-- 插入二级分类（小说类）
INSERT INTO categories (category_code, category_name, level, parent_id, icon, color, sort_order, is_system)
SELECT 'NOVEL_SCIFI', '科幻', 2, id, '🚀', '#4A90E2', 1, TRUE FROM categories WHERE category_code='NOVEL'
UNION ALL
SELECT 'NOVEL_MYSTERY', '推理', 2, id, '🔍', '#7B68EE', 2, TRUE FROM categories WHERE category_code='NOVEL'
UNION ALL
SELECT 'NOVEL_WUXIA', '武侠', 2, id, '⚔️', '#CD5C5C', 3, TRUE FROM categories WHERE category_code='NOVEL'
UNION ALL
SELECT 'NOVEL_ROMANCE', '言情', 2, id, '💕', '#FF69B4', 4, TRUE FROM categories WHERE category_code='NOVEL'
UNION ALL
SELECT 'NOVEL_HISTORY', '历史', 2, id, '📜', '#DAA520', 5, TRUE FROM categories WHERE category_code='NOVEL'
UNION ALL
SELECT 'NOVEL_OTHER', '其他', 2, id, '📖', '#808080', 6, TRUE FROM categories WHERE category_code='NOVEL';

-- 插入二级分类（文学类）
INSERT INTO categories (category_code, category_name, level, parent_id, icon, color, sort_order, is_system)
SELECT 'LITERATURE_POETRY', '诗歌', 2, id, '✍️', '#9370DB', 1, TRUE FROM categories WHERE category_code='LITERATURE'
UNION ALL
SELECT 'LITERATURE_PROSE', '散文', 2, id, '🍂', '#BC8F8F', 2, TRUE FROM categories WHERE category_code='LITERATURE'
UNION ALL
SELECT 'LITERATURE_BIOGRAPHY', '传记', 2, id, '👤', '#696969', 3, TRUE FROM categories WHERE category_code='LITERATURE'
UNION ALL
SELECT 'LITERATURE_OTHER', '其他', 2, id, '📚', '#808080', 4, TRUE FROM categories WHERE category_code='LITERATURE';

-- 插入二级分类（社科类）
INSERT INTO categories (category_code, category_name, level, parent_id, icon, color, sort_order, is_system)
SELECT 'SOCIAL_PHILOSOPHY', '哲学', 2, id, '🤔', '#8B4513', 1, TRUE FROM categories WHERE category_code='SOCIAL'
UNION ALL
SELECT 'SOCIAL_PSYCHOLOGY', '心理学', 2, id, '🧠', '#20B2AA', 2, TRUE FROM categories WHERE category_code='SOCIAL'
UNION ALL
SELECT 'SOCIAL_SOCIOLOGY', '社会学', 2, id, '👥', '#4682B4', 3, TRUE FROM categories WHERE category_code='SOCIAL'
UNION ALL
SELECT 'SOCIAL_POLITICS', '政治', 2, id, '⚖️', '#B22222', 4, TRUE FROM categories WHERE category_code='SOCIAL'
UNION ALL
SELECT 'SOCIAL_ECONOMY', '经济', 2, id, '💰', '#FFD700', 5, TRUE FROM categories WHERE category_code='SOCIAL';

-- 插入二级分类（历史类）
INSERT INTO categories (category_code, category_name, level, parent_id, icon, color, sort_order, is_system)
SELECT 'HISTORY_CHINA', '中国史', 2, id, '🏯', '#DC143C', 1, TRUE FROM categories WHERE category_code='HISTORY'
UNION ALL
SELECT 'HISTORY_WORLD', '世界史', 2, id, '🌍', '#228B22', 2, TRUE FROM categories WHERE category_code='HISTORY'
UNION ALL
SELECT 'HISTORY_ARCHAEOLOGY', '考古', 2, id, '🏺', '#CD853F', 3, TRUE FROM categories WHERE category_code='HISTORY'
UNION ALL
SELECT 'HISTORY_CULTURE', '文化', 2, id, '🎭', '#DDA0DD', 4, TRUE FROM categories WHERE category_code='HISTORY';

-- 插入二级分类（科技类）
INSERT INTO categories (category_code, category_name, level, parent_id, icon, color, sort_order, is_system)
SELECT 'TECH_COMPUTER', '计算机', 2, id, '💻', '#1E90FF', 1, TRUE FROM categories WHERE category_code='TECH'
UNION ALL
SELECT 'TECH_SCIENCE', '科普', 2, id, '🔬', '#32CD32', 2, TRUE FROM categories WHERE category_code='TECH'
UNION ALL
SELECT 'TECH_MATH', '数学', 2, id, '🧮', '#FF8C00', 3, TRUE FROM categories WHERE category_code='TECH'
UNION ALL
SELECT 'TECH_OTHER', '其他', 2, id, '🛠️', '#808080', 4, TRUE FROM categories WHERE category_code='TECH';

-- 插入二级分类（艺术类）
INSERT INTO categories (category_code, category_name, level, parent_id, icon, color, sort_order, is_system)
SELECT 'ART_PAINTING', '绘画', 2, id, '🎨', '#FF1493', 1, TRUE FROM categories WHERE category_code='ART'
UNION ALL
SELECT 'ART_MUSIC', '音乐', 2, id, '🎵', '#9932CC', 2, TRUE FROM categories WHERE category_code='ART'
UNION ALL
SELECT 'ART_PHOTOGRAPHY', '摄影', 2, id, '📷', '#708090', 3, TRUE FROM categories WHERE category_code='ART'
UNION ALL
SELECT 'ART_DESIGN', '设计', 2, id, '🏛️', '#2F4F4F', 4, TRUE FROM categories WHERE category_code='ART';

-- 插入二级分类（生活类）
INSERT INTO categories (category_code, category_name, level, parent_id, icon, color, sort_order, is_system)
SELECT 'LIFE_HEALTH', '健康', 2, id, '💪', '#00CED1', 1, TRUE FROM categories WHERE category_code='LIFE'
UNION ALL
SELECT 'LIFE_FOOD', '美食', 2, id, '🍳', '#FF6347', 2, TRUE FROM categories WHERE category_code='LIFE'
UNION ALL
SELECT 'LIFE_TRAVEL', '旅行', 2, id, '✈️', '#87CEEB', 3, TRUE FROM categories WHERE category_code='LIFE'
UNION ALL
SELECT 'LIFE_HOME', '家居', 2, id, '🏡', '#3CB371', 4, TRUE FROM categories WHERE category_code='LIFE';

-- 插入二级分类（童书类）
INSERT INTO categories (category_code, category_name, level, parent_id, icon, color, sort_order, is_system)
SELECT 'CHILDREN_PICTURE', '绘本', 2, id, '🌈', '#FFA500', 1, TRUE FROM categories WHERE category_code='CHILDREN'
UNION ALL
SELECT 'CHILDREN_LITERATURE', '儿童文学', 2, id, '🧸', '#FFB6C1', 2, TRUE FROM categories WHERE category_code='CHILDREN'
UNION ALL
SELECT 'CHILDREN_SCIENCE', '科普', 2, id, '🦕', '#90EE90', 3, TRUE FROM categories WHERE category_code='CHILDREN'
UNION ALL
SELECT 'CHILDREN_EDUCATION', '教辅', 2, id, '✏️', '#F0E68C', 4, TRUE FROM categories WHERE category_code='CHILDREN';

-- 插入二级分类（其他类）
INSERT INTO categories (category_code, category_name, level, parent_id, icon, color, sort_order, is_system)
SELECT 'OTHER_UNCATEGORIZED', '未分类', 2, id, '📦', '#D3D3D3', 1, TRUE FROM categories WHERE category_code='OTHER';
```

---

## 5. API 接口设计

### 5.1 分类列表（管理端）

```http
GET /api/admin/categories
Authorization: Bearer {admin_token}
```

**响应示例**：
```json
{
  "code": 200,
  "data": {
    "total": 36,
    "list": [
      {
        "id": 1,
        "code": "NOVEL",
        "name": "小说",
        "level": 1,
        "icon": "📖",
        "color": "#FF6B6B",
        "book_count": 162,
        "is_active": true,
        "is_system": true,
        "children": [
          {
            "id": 11,
            "code": "NOVEL_SCIFI",
            "name": "科幻",
            "level": 2,
            "icon": "🚀",
            "color": "#4A90E2",
            "book_count": 45
          }
        ]
      }
    ]
  }
}
```

### 5.2 添加分类

```http
POST /api/admin/categories
Authorization: Bearer {admin_token}
Content-Type: application/json

{
  "category_code": "NOVEL_SUSPENSE",
  "category_name": "悬疑",
  "parent_id": 1,
  "level": 2,
  "icon": "🕵️",
  "color": "#8B008B",
  "description": "悬疑、推理类小说",
  "sort_order": 2
}
```

### 5.3 修改分类

```http
PUT /api/admin/categories/{id}
Authorization: Bearer {admin_token}
Content-Type: application/json

{
  "category_name": "悬疑推理",
  "icon": "🔎",
  "color": "#9400D3",
  "sort_order": 3
}
```

### 5.4 删除分类

```http
DELETE /api/admin/categories/{id}?migrate_to={target_category_id}
Authorization: Bearer {admin_token}
```

**参数说明**：
- `id`: 要删除的分类ID
- `migrate_to`: 迁移目标分类ID（如果有书籍）

### 5.5 批量更新排序

```http
POST /api/admin/categories/sort
Authorization: Bearer {admin_token}
Content-Type: application/json

{
  "sort_list": [
    {"id": 11, "sort_order": 1},
    {"id": 12, "sort_order": 2},
    {"id": 13, "sort_order": 3}
  ]
}
```

### 5.6 分类统计

```http
GET /api/admin/categories/statistics
Authorization: Bearer {admin_token}
```

**响应**：
```json
{
  "code": 200,
  "data": {
    "total_categories": 36,
    "level1_count": 9,
    "level2_count": 27,
    "active_count": 36,
    "disabled_count": 0,
    "total_books": 777,
    "top_categories": [
      {"name": "小说-科幻", "book_count": 45},
      {"name": "小说-推理", "book_count": 32},
      {"name": "社科-心理学", "book_count": 28}
    ]
  }
}
```

---

## 6. 权限控制

### 6.1 角色定义

| 角色 | 权限 |
|------|------|
| 超级管理员 | 所有分类管理权限 |
| 普通管理员 | 查看、添加、编辑（非系统分类） |
| 普通用户 | 仅查看分类（用于选择） |

### 6.2 操作权限矩阵

| 操作 | 超级管理员 | 普通管理员 | 普通用户 |
|------|-----------|-----------|---------|
| 查看分类列表 | ✅ | ✅ | ✅ |
| 添加分类 | ✅ | ✅ | ❌ |
| 编辑分类（非系统） | ✅ | ✅ | ❌ |
| 编辑分类（系统） | ✅ | ❌ | ❌ |
| 删除分类（非系统） | ✅ | ✅ | ❌ |
| 删除分类（系统） | ✅ | ❌ | ❌ |
| 批量操作 | ✅ | ⚠️ 部分 | ❌ |
| 查看操作日志 | ✅ | ✅ | ❌ |

---

## 7. 业务规则

### 7.1 分类约束

1. **层级限制**：最多2级分类（一级分类 + 二级分类）
2. **唯一性**：同一父级下的分类名称不能重复
3. **系统分类保护**：标记为 `is_system=true` 的分类不允许删除，仅允许修改名称、图标、颜色
4. **代码规范**：分类代码必须为大写英文字母和下划线组合，如 `NOVEL_SCIFI`
5. **排序范围**：排序号范围 0-999

### 7.2 删除规则

```
删除分类时：
1. 检查是否为系统分类（是 → 拒绝删除）
2. 检查是否有子分类（是 → 必须先删除子分类）
3. 检查是否有关联书籍
   - 有书籍 → 要求指定迁移目标分类
   - 无书籍 → 直接删除
4. 记录操作日志
```

### 7.3 级联更新

```
修改一级分类时：
- 自动更新所有二级分类的 parent_id
- 更新所有关联书籍的分类路径

删除一级分类时：
- 必须先删除或迁移所有二级分类
- 迁移所有关联书籍
```

---

## 8. 用户端展示

### 8.1 C 端分类选择器

虽然分类管理是管理端功能，但用户在录入书籍时需要选择分类。

**UI设计**：

```
┌──────────────────────────────────────┐
│  选择分类                             │
├──────────────────────────────────────┤
│                                      │
│  一级分类                             │
│  ┌────┬────┬────┬────┬────┬────┐   │
│  │📖  │📚  │👥  │🏯  │💻  │🎨  │   │
│  │小说│文学│社科│历史│科技│艺术│   │
│  └────┴────┴────┴────┴────┴────┘   │
│  ┌────┬────┬────┐                  │
│  │💪  │🌈  │📦  │                  │
│  │生活│童书│其他│                  │
│  └────┴────┴────┘                  │
│                                      │
│  二级分类（已选：小说）               │
│  ┌────┬────┬────┐                  │
│  │🚀  │🔍  │⚔️  │                  │
│  │科幻│推理│武侠│                  │
│  └────┴────┴────┘                  │
│  ┌────┬────┬────┐                  │
│  │💕  │📜  │📖  │                  │
│  │言情│历史│其他│                  │
│  └────┴────┴────┘                  │
│                                      │
│  已选：小说 > 科幻                    │
│                                      │
│  [ 取消 ]         [ 确定 ]           │
│                                      │
└──────────────────────────────────────┘
```

---

## 9. 实施计划

### 9.1 开发排期

| 阶段 | 任务 | 工期 | 负责人 |
|------|------|------|--------|
| 第1周 | 数据库表设计与创建 | 2天 | 后端 |
| 第1周 | 初始化36个标准分类数据 | 1天 | 后端 |
| 第2周 | 管理端 CRUD API 开发 | 3天 | 后端 |
| 第2周 | 管理端前端页面开发 | 2天 | 前端 |
| 第3周 | 排序、批量操作功能 | 2天 | 全栈 |
| 第3周 | 权限控制实现 | 1天 | 后端 |
| 第4周 | C 端分类选择器 | 2天 | 前端 |
| 第4周 | 测试与优化 | 3天 | 测试 |

### 9.2 测试用例

| 测试项 | 预期结果 |
|--------|---------|
| 添加一级分类 | 成功创建，自动分配ID和编码 |
| 添加二级分类 | 成功创建，正确关联父分类 |
| 修改分类名称 | 成功修改，关联书籍自动更新 |
| 删除空分类 | 直接删除成功 |
| 删除有书籍的分类 | 强制指定迁移目标 |
| 删除系统分类 | 拒绝操作，提示错误 |
| 拖拽排序 | 保存后顺序正确更新 |
| 权限控制 | 普通管理员无法删除系统分类 |

---

## 10. 附录

### 10.1 与中图法的对照

为了方便专业用户，可提供中图法对照：

| 本系统分类 | 中图法编号 | 中图法名称 |
|-----------|-----------|-----------|
| 小说-科幻 | I247.7 | 当代科幻小说 |
| 小说-推理 | I247.73 | 侦探小说 |
| 社科-心理学 | B84 | 心理学 |
| 科技-计算机 | TP | 自动化技术、计算机技术 |
| 历史-中国史 | K2 | 中国史 |

### 10.2 数据导出格式

支持导出为 JSON 或 CSV 格式：

**JSON 格式**：
```json
{
  "categories": [
    {
      "code": "NOVEL",
      "name": "小说",
      "level": 1,
      "icon": "📖",
      "color": "#FF6B6B",
      "children": [
        {
          "code": "NOVEL_SCIFI",
          "name": "科幻",
          "level": 2,
          "icon": "🚀",
          "color": "#4A90E2"
        }
      ]
    }
  ]
}
```

**CSV 格式**：
```csv
编号,一级分类,二级分类,图标,颜色,书籍数,创建时间
1.1,小说,科幻,🚀,#4A90E2,45,2025-01-15
1.2,小说,推理,🔍,#7B68EE,32,2025-01-15
```

---

**文档版本**: v1.0.0
**创建日期**: 2025-01-15
**更新日期**: 2025-01-15
**文档状态**: ✅ 已完成
**维护人**: 系统管理员
