# 微书包详细需求文档（V1.0）

> 基于《微书包功能需求》清单进行系统化细化，明确范围、流程、验收标准与非功能性要求，指导后续产品、设计、研发与测试工作。

---

## 0. 文档信息
- 文档版本：V1.0（初版）
- 更新时间：2025-10-14
- 适用范围：微书包产品（移动端为主，Web 管理端为辅）
- 目标读者：产品、设计、后端、前端、测试、运维

## 1. 概述与范围
- 范围：用户注册与登录、个人信息与成就、实体书管理、首页与社区、电子书阅读、群组与分享、AI知识与综述、通知与IM集成（可选）。
- 不在当前版本范围：图书馆数据接入、AR游戏相关功能、强依赖的线下馆藏系统整合。
- 交付目标：可上线的 MVP（具备基本书籍管理与阅读记录、社区互动、AI问答、群组分享）。

## 2. 术语与角色
- 角色：
  - `访客`：未登录用户。
  - `普通用户`：已注册用户，拥有个人书架与基础权限。
  - `管理员`：具备内容与群组管理权限，可维护轮播、处理举报。
- 术语：
  - `实体书`：用户私藏纸质书目。
  - `电子书`：用户上传的数字书籍（PDF/EPUB）。
  - `书架`：用户的实体书集合与组织结构（含分类、标签）。
  - `分享`：将书架、书单或单本书以公开链接方式展示。

## 3. 总体架构与集成概览（概念）
- 客户端：移动端（优先）、Web 管理端（轮播与运营配置）。
- 后端：账户与权限、书籍数据、借阅记录、推荐服务、群组与消息、AI知识库与问答、任务调度（爬虫/索引）。
- 第三方：短信服务（验证码）、对象存储（头像/附件/电子书）、IM服务（可插拔）、TTS引擎、反垃圾服务。

## 4. 非功能性要求
- 性能：
  - 首页首屏接口 ≤ 800ms；关键操作（注册、登录、扫码入库）≤ 1500ms。
  - 列表分页拉取默认 20 条，支持上拉加载。
- 可靠性：
  - 日志与监控：关键路径埋点、异常上报（含验证码、上传、导入）。
  - 数据备份：每日增量，保留 30 天；对象存储版本化开启。
- 安全与隐私：
  - 密码加密存储、敏感数据传输全程 HTTPS、手机号脱敏显示。
  - 权限隔离：私藏不公开，公开需用户主动授权；群组管理员操作审计。
- 合规：
  - 短信发送频率限制与退订文案；用户数据删除/导出能力（后续版本）。
- 兼容与可用性：
  - 移动端适配 iOS/Android 主流机型；无障碍基础支持（字体、对比度）。

---

## 5. 模块需求

### 5.1 用户模块
#### 范围与目标
- 支持手机号注册与登录（验证码或密码），完善个人信息与头像；提供阅读成就与等级体系。

#### 用户故事
- 作为新用户，我可以用手机号获取验证码完成注册，并在首次登录后完善头像与昵称。
- 作为已注册用户，我可以通过验证码或密码登录，并安全地修改我的个人信息。
- 作为活跃读者，我在完成一本书或发表评论时获得经验值，逐步解锁等级称号。

#### 业务流程（注册/登录）
- 手机号注册（验证码）：输入手机号 → 发送验证码（60s 冻结，单号上限 5 次/天） → 验证成功 → 创建账号 → 首次登录引导完善信息。
- 手机号+密码注册：输入手机号 + 密码（6-16位，含字母与数字） → 校验通过 → 创建账号。
- 登录：手机号 + 验证码 或 手机号 + 密码 → 成功后进入首页。

#### 界面与交互要点
- 输入框实时校验：手机号格式、密码强度（含提示文案）。
- 验证码按钮状态：倒计时、置灰、失败提示（网络/频率限制）。
- 首次登录弹窗/页：头像上传（裁剪）、昵称、性别、签名均可选填。

#### 校验与异常
- 已注册手机号：提示“该手机号已绑定账号，可直接登录”。
- 验证码错误/超时：提示“验证码无效或已过期”。
- 密码不符：提示“需包含数字和字母，长度6-16位”。

#### 数据模型（简要）
- `User`：id, phone, password_hash(可空), nickname, avatar_url, gender, bio, level, xp, created_at, updated_at, status。
- `AchievementLog`：id, user_id, type(完成书/评论), xp_delta, created_at。

#### 成就与等级规则（初版）
- XP 获得：完成一本书 +50；有效评论 +10（≥50字）。
- 等级区间：Lv1(0-99), Lv2(100-299), Lv3(300-699), Lv4(700-1499), Lv5(1500+)；称号示例：书虫/书评达人。

#### 验收标准
- 注册/登录流程均可用，异常提示准确；首次登录引导页正常展示与跳过。
- 头像上传支持裁剪与预览；个人信息变更实时更新。
- 完成书籍或发表评论后，XP 与等级展示正确并可追溯日志。

---

### 5.2 实体书书籍管理
#### 范围与目标
- 支持扫码录入、Excel 导入导出、书籍信息完善、隐私设置、借阅记录与提醒、查找与位置指引、分类与分析、微数据库与爬虫。

#### 用户故事
- 我可以通过扫描书籍二维码快速录入书籍信息，缺失项可手动补录。
- 我可以从 Excel 批量导入我的藏书，并将我的书架导出为模板格式。
- 我可以设置书籍为私藏或公开，并记录借阅历史、接收归还提醒。
- 我可以按编号或关键词快速查找书籍，并查看详细信息与实体位置编号。

#### 业务流程
- 扫码录入：扫描 ISBN/二维码 → 拉取基础信息（出版时间、ISBN、定价等） → 用户确认 → 入库。
- 导入：下载模板 → 填写并上传 → 校验与预览 → 入库（失败行与原因回显）。
- 借阅：选书 → 记录借出（借出人、时间、预计归还日期） → 到期提醒 → 归还记录。

#### 界面与交互要点
- 扫码页：对焦/闪光灯、失败重试、手动录入入口。
- 导入页：模板下载按钮、文件上传进度、失败行导出。
- 详情页：目录、摘要、作者简介、书评、图片；隐私设置切换（私藏/公开）。

#### 校验与异常
- 扫码失败或网络异常：提示并可手动录入。
- 导入格式错误：逐行错误提示（必填列缺失、类型不符、重复 ISBN）。

#### 数据模型（简要）
- `Book`：id, owner_id, isbn, title, author, publisher, publish_date, price, cover_url, summary, catalog, author_bio, privacy(private/public), location_code, tags[], created_at, updated_at。
- `BorrowRecord`：id, book_id, borrower_name, contact(optional), borrowed_at, due_at, returned_at, notes。

#### Excel 模板（列规范，详见附录）
- 必填：`ISBN`, `书名`, `作者`；选填：`出版社`, `出版时间`, `定价`, `位置编号`, `标签`。

#### 微数据库与爬虫
- 每本书建立舆情库：抓取来源（豆瓣/知乎/电商书评等，合法合规），去重与质检，展示精选短评。
- 爬虫频率与限额：每日队列，失败重试，尊重 Robots 与版权。

#### 查找与位置指引
- 支持编号/关键词搜索；详情显示 `位置编号`，用于实体书快速定位。

#### 分类与分析
- 分类：自定义分类与标签；分析：统计阅读偏好（作者、主题、年份）。

#### 验收标准
- 扫码入库成功率 ≥ 95%；导入校验与失败原因清晰；导出与模板一致。
- 借阅记录完整，提醒消息按时触达；隐私设置可控且默认私藏。
- 搜索精准，位置编号清晰展示；分析报表可生成基础图表。

---

### 5.3 首页及社区互动
#### 范围与目标
- 首页运营位（轮播）、个性化推荐、读书计划与提醒、成就展示、社区互动（书评/讨论/点赞/收藏/举报）。

#### 用户故事
- 我可以在首页看到轮播位与为我推荐的书单/新书。
- 我可以设定每日读书计划并接收提醒，完成后获得成就点数。
- 我可以在社区分享书评，与书友互动并收到回复通知。

#### 业务流程
- 轮播配置（管理员）：上传图片 → 设置链接（站内/外） → 上线时间与优先级。
- 推荐：基于历史阅读与相似用户生成书单；冷启动用热门/编辑精选兜底。
- 读书计划：设置每日时段与时长 → 通知提醒 → 完成打卡 → 加成 XP。

#### 界面与交互要点
- 轮播：滑动、点击跳转；异常占位与兜底图。
- 社区：列表分页、详情页评论与回复、点赞收藏、举报入口。

#### 校验与异常
- 外链风险提示；反垃圾与敏感词过滤；举报与封禁流程。

#### 数据模型（简要）
- `Post`：id, author_id, book_id(optional), title, content, images[], likes_count, comments_count, status, created_at。
- `Comment`：id, post_id, author_id, content, likes_count, status, created_at。
- `ReadingPlan`：id, user_id, daily_time_slot, duration_minutes, reminder_channel, status。

#### 验收标准
- 轮播配置后台可用，前台展示正确；推荐有可解释日志与 fallback。
- 计划提醒按时；打卡成功产生 XP；社区互动操作稳定，举报可闭环。

---

### 5.4 电子书阅读
#### 范围与目标
- 支持电子书上传与阅读（PDF/EPUB 初版）、目录与书签、阅读进度记录、AI 问答、跨设备同步、阅读日志。

#### 用户故事
- 我可以上传电子书并在内置阅读器中阅读，记录书签与进度。
- 我可以就当前电子书内容进行提问，系统结合知识库回答。
- 我可以在不同设备上同步我的阅读进度与书签。

#### 业务流程
- 上传：选择文件 → 校验格式/大小 → 存储 → 解析目录（EPUB） → 创建记录。
- 阅读：打开 → 翻页/目录跳转 → 添加书签/高亮 → 自动记录进度与时长。
- AI 问答：选书上下文 → 提问 → 检索与生成 → 展示回答与引用片段。
- 同步：登录账号拉取最近进度；冲突以最新写入为准并提示。

#### 界面与交互要点
- 阅读器：翻页、目录、搜索、书签、高亮；进度条与已读百分比。
- 问答：问题输入框、结果展示、引用高亮、追问串联。

#### 校验与异常
- 上传大小限制（例如 ≤ 200MB）；病毒/木马扫描；格式解析失败提示。

#### 数据模型（简要）
- `EBook`：id, owner_id, title, format, size, storage_url, cover_url, toc, created_at。
- `ReadingLog`：id, user_id, book_id, type(实体/电子), progress(0-100), minutes, last_opened_at。

#### 验收标准
- 支持 PDF/EPUB 基础阅读；进度同步稳定；AI 问答可在限定上下文内输出可解释答案。

---

### 5.5 群组与好友
#### 范围与目标
- 支持群组建立/删除、权限管理（管理员可剔除）、添加/删除好友、分享书籍/书单与实体书架到群组或公开链接、收藏他人分享、实时通讯与通知提醒。

#### 用户故事
- 我可以创建群组、邀请成员并管理权限；需要时可剔除违规用户。
- 我可以与好友互相关注/添加，查看对方公开分享并收藏到我的书架。
- 我可以在群组内分享书籍与书单，并接收群消息与系统通知。

#### 业务流程
- 群组：创建 → 邀请（链接/二维码） → 权限设定（管理员/成员） → 分享与互动 → 管理操作（剔除/解散）。
- 好友：搜索/扫描 → 请求与通过 → 互相关注 → 私信或群内互动。
- 分享：选择资源（书/书单/书架） → 生成分享链接 → 权限设定（公开/仅群） → 浏览与收藏。

#### 界面与交互要点
- 群组列表与成员管理；分享对象选择器；收藏夹与来源标注。
- 通知：系统消息与群消息列表，未读红点，置顶与免打扰。

#### 校验与异常
- 分享权限校验；私藏资源不可被公开；邀请链接有效期与次数限制。

#### 数据模型（简要）
- `Group`：id, name, owner_id, members_count, settings, created_at。
- `Friendship`：id, user_id, friend_user_id, status(pending/accepted/blocked), created_at。
- `Share`：id, owner_id, resource_type(book/list/shelf), resource_id, visibility(public/group/private), link_token, expires_at。

#### 验收标准
- 群组权限准确；分享链接与收藏闭环顺畅；通知提醒稳定（去重与限频）。

---

### 5.6 AI 功能
#### 范围与目标
- 知识库：收录相关书籍 PDF、爬取的简评与用户评论。
- 文献综述：基于知识库生成主题性综述，提供引用与导出。
- 附件上传：用户可上传补充知识，参与问答。
- 语音朗读：内置 TTS 朗读（章节级）。

#### 用户故事
- 我可以将我拥有的书籍 PDF 纳入知识库，并就其内容提问。
- 我可以让系统生成某主题的文献综述，支持导出与引用说明。
- 我可以上传附件提升问答质量；我可以用语音朗读一本书的部分章节。

#### 业务流程
- 知识入库：上传/抓取 → 清洗与切分 → 向量化索引 → 可用状态。
- 问答：检索（RAG）→ 生成 → 展示答案与引用（文献/页码）。
- 文献综述：选择主题与范围 → 汇总关键观点 → 生成章节结构 → 导出（Markdown/Docx）。
- TTS：选择章节 → 生成语音 → 播放与缓存 → 下载（可选）。

#### 校验与异常
- 版权与合法性提示；个人数据默认私有；可撤回与删除入库内容。
- 生成内容免责声明与准确性提示；成本与速率限制（排队与进度）。

#### 数据模型（简要）
- `KnowledgeItem`：id, owner_id, source_type(pdf/crawl/comment), title, metadata, vector_id, created_at。
- `QAHistory`：id, user_id, question, answer, citations[], created_at。

#### 验收标准
- 问答展示引用与可解释性；综述结构清晰可导出；附件入库与删除流程闭环；TTS 稳定生成与播放。

---

## 6. 系统接口清单（初版，示例）
- 账户与验证码：`POST /auth/send-otp`, `POST /auth/register`, `POST /auth/login`, `GET /user/me`, `PUT /user/profile`。
- 书籍管理：`POST /books/scan`, `POST /books`, `GET /books`, `PUT /books/{id}`, `POST /books/import`, `GET /books/export`。
- 借阅与提醒：`POST /borrow`, `PUT /borrow/{id}/return`, `GET /borrow`。
- 社区：`POST /posts`, `GET /posts`, `POST /comments`, `POST /posts/{id}/like`。
- 电子书：`POST /ebooks/upload`, `GET /ebooks`, `GET /ebooks/{id}`, `POST /reading/log`。
- 群组与好友：`POST /groups`, `GET /groups`, `POST /groups/{id}/kick`, `POST /friends`, `PUT /friends/{id}`。
- 分享：`POST /shares`, `GET /shares/{token}`, `POST /collections`。
- AI：`POST /ai/ingest`, `POST /ai/qa`, `POST /ai/review`, `POST /ai/tts`。

## 7. 数据字典（核心）
- 字段命名采用小写下划线；时间统一 `ISO8601`；金额单位为分；布尔默认 false。
- 关键表：`users`, `books`, `borrow_records`, `posts`, `comments`, `ebooks`, `reading_logs`, `groups`, `friendships`, `shares`, `knowledge_items`, `qa_history`。

## 8. 埋点与指标
- 注册与登录转化；验证码发送成功率；导入成功率与失败分布；借阅提醒送达率；推荐点击率；社区发帖/评论/点赞行为；阅读时长与完成率；AI 问答成功率与用户反馈；TTS 使用频次。

## 9. 里程碑与交付
- M1（2-3周）：用户注册与登录、书籍扫码与导入、基础书籍详情与隐私、阅读记录。
- M2（2-3周）：首页轮播与推荐、读书计划、社区发帖与评论、成就系统。
- M3（2-3周）：电子书阅读器与进度同步、AI 问答与知识入库、群组与分享、通知提醒。
- M4（后续）：文献综述导出、TTS 完善、报表与分析、数据导出与删除能力。

## 10. 风险与假设
- 短信服务速率与成本；ISBN 数据源质量；爬虫的合规性与稳定性；AI 服务成本与延迟；IM 接入的复杂度与对外依赖。
- 假设：用户对分享/社区有较强意愿；电子书以个人学习为主；对象存储容量充足。

## 11. 合规与隐私
- 明确用户数据用途、存储与保留策略；支持用户请求删除个人数据；分享默认私有，公开需二次确认；内容审核与举报机制闭环。

## 12. 开放问题与后续规划
- 推荐算法的具体实现与评估标准；社区运营策略与版主机制；AI 引擎选择与成本控制策略；IM 选择（自研/第三方）。

## 13. 附录：Excel 导入模板（示例）
- 列与说明：
  - `ISBN`（必填，字符串）
  - `书名`（必填，字符串）
  - `作者`（必填，字符串）
  - `出版社`（选填，字符串）
  - `出版时间`（选填，YYYY-MM-DD）
  - `定价`（选填，数字，单位元）
  - `位置编号`（选填，字符串）
  - `标签`（选填，逗号分隔）
- 校验：空值、类型、重复 ISBN 检查；失败行导出与逐项原因。

---

> 注：原清单编号缺少 “5”，本详细文档已按模块重整并保留原范围说明；后续迭代可在此基础上补充设计稿、接口契约与测试用例。